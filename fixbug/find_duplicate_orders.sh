#!/bin/bash
# @Auther: Yao Shuai

sed -n -e '/More than one callback on a same order/p' tail.out  | sed -n -e '/product_id=sgqyzdy30/p' | awk '{print $22}' | sed -n -e 's/id://p'

# inner join 比 sub queries快很多哇
# select passportId from t_orders where orderId in ('c20a5577-011b-48d1-bece-92ad673f99e6','6ad22177-5caf-464b-a743-6862796f5ee5','725143e3-3bda-48e9-bfd6-4bfae5918d1e','4bbdbe1a-a8e0-41d3-9a26-91094d115159','ede34b17-2081-4a05-bcb3-dd5003500842','6dea4f09-859a-4e46-8dbb-fb3831b75327','6dea4f09-859a-4e46-8dbb-fb3831b75327','b6ad7d56-f613-4d89-8664-7e7d894b4b58','6dbed498-6016-4e21-9505-ff6593db24fc','bc3f5c8a-7e90-42c5-b31c-c017d2471f29','3023a703-2c1f-48cd-b624-74c3efa41bdb','17608c9c-89cc-4ee7-8aae-e73a72a93fa5','87297b08-d64b-48a7-b575-499b0a30d9be','93bf01cf-09b1-4b5c-8537-8d1fe62bc6a3','5948d627-1c52-4424-9b17-f6b8d9592013','42eb606e-44f2-48fc-b602-5ece0adcbf12','c04bd885-1ae0-4ede-b27a-f1f6acf211c0','d271c4ab-8f20-4552-9bb3-458949657b3e','af24c3ff-c785-4f0a-87bb-b4b76e7c942c','2f4ea090-b72b-4393-9f29-0720aed86b07','1c1237bf-fda4-498c-9708-14185161a86e','9e3f4b2c-f3e9-4782-9242-478601fe2c4e','c66232ae-6f99-46f7-a22a-07eccc4cb70e','769c321e-5860-4e69-9755-bd44dc786e3b','2109714c-3c42-43e6-8681-0e07c5b21219','bf82d496-eec6-47d8-b0cd-a27685730d29');
#  select p.id, t.passportId, from_unixtime(p.subexpiretime/1000),p.chargeKindId from (select passportId from t_orders where orderId in ('c20a5577-011b-48d1-bece-92ad673f99e6','6ad22177-5caf-464b-a743-6862796f5ee5','725143e3-3bda-48e9-bfd6-4bfae5918d1e','4bbdbe1a-a8e0-41d3-9a26-91094d115159','ede34b17-2081-4a05-bcb3-dd5003500842','6dea4f09-859a-4e46-8dbb-fb3831b75327','6dea4f09-859a-4e46-8dbb-fb3831b75327','b6ad7d56-f613-4d89-8664-7e7d894b4b58','6dbed498-6016-4e21-9505-ff6593db24fc','bc3f5c8a-7e90-42c5-b31c-c017d2471f29','3023a703-2c1f-48cd-b624-74c3efa41bdb','17608c9c-89cc-4ee7-8aae-e73a72a93fa5','87297b08-d64b-48a7-b575-499b0a30d9be','93bf01cf-09b1-4b5c-8537-8d1fe62bc6a3','5948d627-1c52-4424-9b17-f6b8d9592013','42eb606e-44f2-48fc-b602-5ece0adcbf12','c04bd885-1ae0-4ede-b27a-f1f6acf211c0','d271c4ab-8f20-4552-9bb3-458949657b3e','af24c3ff-c785-4f0a-87bb-b4b76e7c942c','2f4ea090-b72b-4393-9f29-0720aed86b07','1c1237bf-fda4-498c-9708-14185161a86e','9e3f4b2c-f3e9-4782-9242-478601fe2c4e','c66232ae-6f99-46f7-a22a-07eccc4cb70e','769c321e-5860-4e69-9755-bd44dc786e3b','2109714c-3c42-43e6-8681-0e07c5b21219','bf82d496-eec6-47d8-b0cd-a27685730d29')) as t inner join t_platform_user as p where p.id=t.passportId;

#update t_platform_user set subexpiretime = unix_timestamp('2020-08-12 14:42:04') * 1000 where id=306253252;
#update t_platform_user set subexpiretime = unix_timestamp('2020-08-13 07:32:07') * 1000 where id=303536468;